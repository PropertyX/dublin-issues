/**
 * Dublin(tm) : Bulletin board software (https://github.com/PropertyX)
 * Copyright (c) PropertyX Software Foundation, Inc. (https://github.com/Property)
 *
 * Licensed under The MIT License
 * For full copyright and license information, please see the LICENSE.txt
 * Redistributions of files must retain the above copyright notice.
 *
 * @copyright Copyright (c) PropertyX Software Foundation, Inc. (https://github.com/PropertyX)
 * @link      https://github.com/PropertyX
 * @since     1.0
 * @license   http://www.opensource.org/licenses/mit-license.php MIT License
 */

 $(function() 
    {
        $("#textEditor").wysibb();
        if($("#customUploadButton").html() !== undefined) 
        {
            document.getElementById("customUploadButton").onchange = function()
            {
                document.getElementById("customUploadBox").value = this.value;
            };
        }
    }
 );

 $("#closeMessage").click(
    function()
    {
        $("#messageGlobal").hide();
    }
 );

 $(".addSubmitted").click(
    function()
    {
        $(".addSubmitted").removeClass('btn-dublin').addClass('btn-submit').val('');
    }
 );

 $("#formShout").submit(function(e)
 {
    var message = $('#shout').val();
    var controller = '/xmlhttp/shoutbox/add/';

    if(message == '')
    {
        $('.shout-field').addClass('chat-error');
        setTimeout(
            function() 
            {
                $('.shout-field').removeClass('chat-error');
            }, 3000
        );
    } else
    {
        $.ajax({
            url: controller,
            method: 'POST',
            data: 
            {
                shout: message
            },
            success: function(data) 
            {
                console.log(data);
                $('.shout-field').val('');
                $('.shout-field').prop('disabled', true);

                var seconds = 0;
                $('.shout-field').val('...');
                var waitTimer = setInterval(function()
                {
                    seconds++;

                    if(seconds == 1) 
                    {
                        $('.shout-field').val('Wacht 3 seconden...');
                    } else if(seconds == 2) 
                    {
                        $('.shout-field').val('Wacht 2 seconden...');
                    } else if(seconds == 3) 
                    {
                        $('.shout-field').val('Wacht 1 seconden...');
                    } else if(seconds == 4)
                    {
                        $('.shout-field').prop('disabled', false); $('.shout-field').val('');
                        clearInterval(waitTimer);
                    }
                }, 1000);
            }, error: function() 
            {
                $('.shout-field').addClass('chat-error');
                $('.shout-field').val('Oops!');
                setTimeout(
                    function() 
                    {
                        $('.shout-field').removeClass('chat-error');
                        $('.shout-field').val('');
                    }, 3000
                );
            }
        });
    }

    return false;
 });

 $(document).ready(function() 
 {
    if($("#shouts").html() !== undefined) 
    {
        var controller = '/xmlhttp/shoutbox/load/';

        $.ajax({
            url: controller,
            method: 'GET',
            dataType: 'json',
            success: function(data) 
            {
                var msgs = "";
                for(var i = 0; i < data.length; i++) 
                {
                    msgs += '<div class="shouts-item" chat-user-name="'+ data[i].author.username +'" shout-id="'+ data[i].id +'"><span '
                    			+ data[i].author.usergroup.color + '>' + data[i].author.username + '</span>: ' + data[i].shout +
                    		'<small class="pull-right">' + data[i].created + '</small></div>';
                }

                $("#shouts ul").html(msgs);
            }, error: function() 
            {
            	return false;
            }
        });
    }
 });